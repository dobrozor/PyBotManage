<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}VDS Manager{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <div class="logo">
                <h1>üõ†Ô∏è VDS Manager</h1>
                <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏ –Ω–∞ –≤–∞—à–µ–º —Å–µ—Ä–≤–µ—Ä–µ</p>
            </div>
            {% if current_user.is_authenticated %}
            <div class="auth-info">
                <span class="user-badge">üë§ –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä</span>
                <a href="{{ url_for('logout') }}" class="btn btn-logout">–í—ã–π—Ç–∏</a>
            </div>
            {% endif %}
        </header>

        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="flash-messages">
              {% for category, message in messages %}
                <div class="flash flash-{{ category }}">
                    <span class="flash-icon">
                        {% if category == 'success' %}‚úÖ
                        {% elif category == 'error' %}‚ùå
                        {% elif category == 'info' %}‚ÑπÔ∏è
                        {% elif category == 'warning' %}‚ö†Ô∏è
                        {% endif %}
                    </span>
                    {{ message }}
                </div>
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}

        <main>
            {% block content %}{% endblock %}
        </main>

        <footer>
            <p>VDS Manager ¬© 2026 | –°–æ–∑–¥–∞–Ω–æ —Å ‚ù§Ô∏è –¥–ª—è —É–¥–æ–±–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–æ–º</p>
        </footer>
    </div>

    <script>
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
        function setupLogUpdater(projectName) {
            if (!projectName) return;

            const logContainer = document.getElementById('logs');
            if (!logContainer) return;

            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–≥–∏ –∫–∞–∂–¥—ã–µ 2 —Å–µ–∫—É–Ω–¥—ã
            setInterval(() => {
                fetch(`/project/${projectName}/logs`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.logs && logContainer.textContent !== data.logs) {
                            logContainer.textContent = data.logs;
                            // –ü—Ä–æ–∫—Ä—É—á–∏–≤–∞–µ–º –≤–Ω–∏–∑
                            logContainer.scrollTop = logContainer.scrollHeight;
                        }
                    })
                    .catch(err => {
                        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ª–æ–≥–æ–≤:', err);
                    });
            }, 2000);
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –ø—Ä–æ–µ–∫—Ç–∞
        function setupStatusUpdater(projectName) {
            if (!projectName) return;

            const statusElement = document.querySelector('.status-badge');
            if (!statusElement) return;

            setInterval(() => {
                fetch(`/project/${projectName}/status`)
                    .then(response => response.json())
                    .then(data => {
                        if (data.status) {
                            statusElement.textContent = data.status;
                            statusElement.className = 'status-badge status-' + data.status;
                        }
                    })
                    .catch(err => console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞:', err));
            }, 3000);
        }
    </script>
    {% block scripts %}{% endblock %}
</body>
</html>