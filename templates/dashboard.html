{% extends "base.html" %}
{% block title %}–ü–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è{% endblock %}
{% block content %}
<div class="dashboard">
    <div class="dashboard-header">
        <h2>üìÅ –ú–æ–∏ –ø—Ä–æ–µ–∫—Ç—ã</h2>
        <button class="btn btn-primary" onclick="toggleCreateForm()">
            <span class="btn-icon">‚ûï</span>
            –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
        </button>
    </div>

    <!-- –§–æ—Ä–º–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–µ–∫—Ç–∞ -->
    <div id="create-form" class="create-project-form" style="display:none;">
        <div class="form-card">
            <h3>–°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –ø—Ä–æ–µ–∫—Ç–∞</h3>
            <form method="POST" action="{{ url_for('create_project') }}">
                <div class="form-group">
                    <label for="project-name">–ò–º—è –ø—Ä–æ–µ–∫—Ç–∞:</label>
                    <input
                        type="text"
                        id="project-name"
                        name="name"
                        placeholder="my_project –∏–ª–∏ my-bot"
                        required
                        pattern="^[a-zA-Z0-9_-]+$"
                        title="–¢–æ–ª—å–∫–æ –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è"
                    >
                    <small class="form-hint">–ò–º—è –º–æ–∂–µ—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –¥–µ—Ñ–∏—Å—ã (-) –∏ –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏—è (_)</small>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">
                        <span class="btn-icon">‚úÖ</span>
                        –°–æ–∑–¥–∞—Ç—å
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="toggleCreateForm()">
                        <span class="btn-icon">‚ùå</span>
                        –û—Ç–º–µ–Ω–∞
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- –°–ø–∏—Å–æ–∫ –ø—Ä–æ–µ–∫—Ç–æ–≤ -->
    {% if projects|length == 0 %}
        <div class="empty-state">
            <div class="empty-icon">üìÅ</div>
            <h3>–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø—Ä–æ–µ–∫—Ç–æ–≤</h3>
            <p>–°–æ–∑–¥–∞–π—Ç–µ –ø–µ—Ä–≤—ã–π –ø—Ä–æ–µ–∫—Ç, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ä–∞–±–æ—Ç—É</p>
            <button class="btn btn-primary" onclick="toggleCreateForm()">
                <span class="btn-icon">‚ûï</span>
                –°–æ–∑–¥–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
            </button>
        </div>
    {% else %}
        <div class="projects-grid">
            {% for project in projects %}
            <div class="project-card">
                <div class="project-card-header">
                    <h3 class="project-name">{{ project }}</h3>
                    <span class="status status-{{ statuses[project] }}">{{ statuses[project] }}</span>
                </div>

                <div class="project-card-body">
                    <p class="project-description">
                        –ü—Ä–æ–µ–∫—Ç –Ω–∞ Python —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º —á–µ—Ä–µ–∑ systemd
                    </p>
                </div>

                <div class="project-card-footer">
                    <a href="{{ url_for('project_files', name=project) }}" class="btn btn-small btn-files">
                        <span class="btn-icon">üìÑ</span>
                        –§–∞–π–ª—ã
                    </a>

                    <div class="control-buttons">
                        <form method="POST" action="{{ url_for('control_project', name=project) }}" class="inline-form">
                            <input type="hidden" name="action" value="start">
                            <button type="submit" class="btn btn-small btn-start" title="–ó–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç">
                                <span class="btn-icon">‚ñ∂Ô∏è</span>
                            </button>
                        </form>

                        <form method="POST" action="{{ url_for('control_project', name=project) }}" class="inline-form">
                            <input type="hidden" name="action" value="stop">
                            <button type="submit" class="btn btn-small btn-stop" title="–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç">
                                <span class="btn-icon">‚èπÔ∏è</span>
                            </button>
                        </form>

                        <form method="POST" action="{{ url_for('control_project', name=project) }}" class="inline-form">
                            <input type="hidden" name="action" value="restart">
                            <button type="submit" class="btn btn-small btn-restart" title="–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç">
                                <span class="btn-icon">üîÑ</span>
                            </button>
                        </form>
                    </div>

                    <form method="POST" action="{{ url_for('delete_project', name=project) }}"
                          class="inline-form delete-form"
                          onsubmit="return confirmDelete('{{ project }}')">
                        <button type="submit" class="btn btn-small btn-delete" title="–£–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç">
                            <span class="btn-icon">üóëÔ∏è</span>
                        </button>
                    </form>
                </div>
            </div>
            {% endfor %}
        </div>
    {% endif %}
</div>

<script>
    function toggleCreateForm() {
        const form = document.getElementById('create-form');
        form.style.display = form.style.display === 'none' ? 'block' : 'none';
    }

    function confirmDelete(projectName) {
        return confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –ø—Ä–æ–µ–∫—Ç "${projectName}"?\n\n–í—Å–µ —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –±—É–¥—É—Ç –±–µ–∑–≤–æ–∑–≤—Ä–∞—Ç–Ω–æ —É–¥–∞–ª–µ–Ω—ã!`);
    }
</script>
{% endblock %}